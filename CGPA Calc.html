<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CGPA Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Times New Roman', serif;
      background: white;
      color: black;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      #result, #result * {
        visibility: visible;
      }
      #result {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: white;
        padding: 20px;
        box-sizing: border-box;
        color: black;
      }
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <div class="max-w-4xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">CGPA Calculator</h1>

    <!-- Student Info -->
    <div class="grid sm:grid-cols-2 gap-4 mb-6">
      <div>
        <label for="university" class="font-semibold block mb-1">University:</label>
        <input id="university" type="text" placeholder="University"
          class="w-full mt-1 p-2 border rounded text-black" />
      </div>
      <div>
        <label for="studentName" class="font-semibold block mb-1">Student Name:</label>
        <input id="studentName" type="text" placeholder="Student Name"
          class="w-full mt-1 p-2 border rounded text-black" />
      </div>
      <div>
        <label for="studentId" class="font-semibold block mb-1">Student ID:</label>
        <input id="studentId" type="text" placeholder="Student ID"
          class="w-full mt-1 p-2 border rounded text-black" />
      </div>
      <div>
        <label for="batch" class="font-semibold block mb-1">Batch:</label>
        <input id="batch" type="text" placeholder="Batch"
          class="w-full mt-1 p-2 border rounded text-black" />
      </div>
      <div>
        <label for="department" class="font-semibold block mb-1">Department:</label>
        <input id="department" type="text" placeholder="Department"
          class="w-full mt-1 p-2 border rounded text-black" />
      </div>
    </div>

    <!-- Courses Table -->
    <div class="overflow-x-auto mb-4">
      <table class="w-full border text-center">
        <thead class="bg-gray-100">
          <tr>
            <th class="border px-4 py-2">Course Code</th>
            <th class="border px-4 py-2">Course Title</th>
            <th class="border px-4 py-2">GPA</th>
            <th class="border px-4 py-2">Credit</th>
            <th class="border px-4 py-2 no-print">Delete</th>
          </tr>
        </thead>
        <tbody id="courseTableBody"></tbody>
      </table>
    </div>

    <!-- Buttons -->
    <div class="flex flex-wrap gap-3 justify-center no-print mb-6">
      <button onclick="addCourse()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Add Course</button>
      <button onclick="calculateCGPA()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Generate Grade Sheet</button>
      <button onclick="downloadPDF()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">Export PDF</button>
      <button onclick="printGradeSheet()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">üñ®Ô∏è Print</button>
    </div>

    <!-- Result Output -->
    <div id="result" class="text-center mb-6"></div>
    <p class="text-center text-sm text-gray-400 no-print">Developed by NestedSin</p>
  </div>

  <script>
    // Add a course row
    function addCourse() {
      const tbody = document.getElementById("courseTableBody");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="border p-2"><input type="text" placeholder="e.g. CSE101" class="w-full p-1 border rounded text-black" /></td>
        <td class="border p-2"><input type="text" placeholder="Course Title" class="w-full p-1 border rounded text-black" /></td>
        <td class="border p-2"><input type="number" step="0.01" min="0" max="4" placeholder="GPA" class="w-full p-1 border rounded text-black" /></td>
        <td class="border p-2"><input type="number" step="0.1" min="0" placeholder="Credit" class="w-full p-1 border rounded text-black" /></td>
        <td class="border p-2 no-print"><button class="text-red-600 font-bold hover:text-red-800" onclick="this.closest('tr').remove()">üóëÔ∏è</button></td>`;
      tbody.appendChild(tr);
    }

    // Calculate CGPA and generate grade sheet
    function calculateCGPA() {
      const rows = document.querySelectorAll("#courseTableBody tr");
      let totalPoints = 0;
      let totalCredits = 0;
      let valid = true;
      let outputRows = "";

      for (const row of rows) {
        const code = row.cells[0].querySelector("input").value.trim();
        const title = row.cells[1].querySelector("input").value.trim();
        const gpa = parseFloat(row.cells[2].querySelector("input").value);
        const credit = parseFloat(row.cells[3].querySelector("input").value);

        if (code === "" || title === "") {
          alert("Please fill in Course Code and Course Title for all courses.");
          valid = false;
          break;
        }

        if (isNaN(gpa) || isNaN(credit) || gpa < 0 || gpa > 4 || credit <= 0) {
          alert("Please fill all GPA and Credit fields correctly.\nGPA must be between 0 and 4.\nCredit must be greater than 0.");
          valid = false;
          break;
        }

        totalPoints += gpa * credit;
        totalCredits += credit;

        outputRows += `
          <tr class="border-b">
            <td class="p-2">${code}</td>
            <td class="p-2">${title}</td>
            <td class="p-2">${gpa.toFixed(2)}</td>
            <td class="p-2">${credit.toFixed(1)}</td>
          </tr>`;
      }

      if (!valid) return;

      const cgpa = totalCredits ? (totalPoints / totalCredits).toFixed(2) : "0.00";

      document.getElementById("result").innerHTML = `
        <h2 class="text-2xl font-bold mb-4">Grade Sheet</h2>
        <p><strong>University:</strong> ${document.getElementById("university").value}</p>
        <p><strong>Student Name:</strong> ${document.getElementById("studentName").value}</p>
        <p><strong>Student ID:</strong> ${document.getElementById("studentId").value}</p>
        <p><strong>Batch:</strong> ${document.getElementById("batch").value}</p>
        <p><strong>Department:</strong> ${document.getElementById("department").value}</p>
        <div class="overflow-x-auto my-4">
          <table class="w-full border text-center">
            <thead class="bg-gray-100">
              <tr>
                <th class="border px-2 py-1">Course Code</th>
                <th class="border px-2 py-1">Course Title</th>
                <th class="border px-2 py-1">GPA</th>
                <th class="border px-2 py-1">Credit</th>
              </tr>
            </thead>
            <tbody>${outputRows}</tbody>
          </table>
        </div>
        <h3 class="text-xl font-semibold">Final CGPA: ${cgpa}</h3>
      `;

      document.getElementById("result").scrollIntoView({ behavior: "smooth" });
    }

    // Print grade sheet only
    function printGradeSheet() {
      const result = document.getElementById("result");
      if (!result.innerHTML.trim()) {
        alert("Please generate the grade sheet before printing.");
        return;
      }
      window.print();
    }

    // Export grade sheet as PDF
    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const resultElement = document.getElementById("result");
      if (!resultElement.innerHTML.trim()) {
        alert("Please generate the grade sheet first.");
        return;
      }

      doc.html(resultElement, {
        callback: (doc) => doc.save("GradeSheet.pdf"),
        x: 10,
        y: 10,
        html2canvas: { scale: 0.5, useCORS: true }
      });
    }

    // Initialize one course row on load
    addCourse();
  </script>

</body>
</html>
